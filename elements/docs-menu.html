<link rel="import" href="../components/polymer/polymer.html">
<link rel="import" href="../components/polymer-ui-menu/polymer-ui-menu.html">
<link rel="import" href="../components/polymer-ui-menu-item/polymer-ui-menu-item.html">
<link rel="import" href="../components/polymer-ui-submenu-item/polymer-ui-submenu-item.html">
<!-- <link rel="import" href="ui-color-icon.html"> -->

<polymer-element name="docs-menu" attributes="menu ajaxify coreElements paperElements">

<template>
  <link rel="stylesheet" href="../css/elements/docs-menu.css">
  <polymer-ui-menu id="mainmenu" on-click="{{onClick}}" selectedItem="{{item}}">

    <polymer-ui-submenu-item src="/images/picons/ic_polymer_source.svg"
        class="elements-using {{ {show: menu == 'elements'} | tokenList}}"
        label="Core elements &#x25BE;">
      <template repeat="{{coreElementsList}}">
        <polymer-ui-menu-item href="/docs/elements/core-elements.html#{{name}}"
            data-href="/docs/elements/core-elements.html#{{name}}">{{name}}</polymer-ui-menu-item>
      </template>
    </polymer-ui-submenu-item>
    <polymer-ui-submenu-item src="/images/picons/ic_polymer_source.svg"
        class="elements-using {{ {show: menu == 'elements'} | tokenList}}"
        label="Paper elements &#x25BE;">
      <template repeat="{{paperElementsList}}">
        <polymer-ui-menu-item href="/docs/elements/paper-elements.html#{{name}}"
            data-href="/docs/elements/paper-elements.html#{{name}}">{{name}}</polymer-ui-menu-item>
      </template>
    </polymer-ui-submenu-item>
    <polymer-ui-submenu-item
        label="Labs &#x25BE;"
        src="/images/picons/ic_polymer_source.svg"
        class="{{ {show: menu == 'elements'} | tokenList}}">
      <polymer-ui-menu-item href="/docs/elements/polymer-elements.html">Polymer elements</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/docs/elements/polymer-ui-elements.html">Polymer UI elements</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/docs/elements/other.html">Other</polymer-ui-menu-item>
    </polymer-ui-submenu-item>

    <polymer-ui-submenu-item src="/images/picons/ic_polymer_source.svg"
        class="{{ {show: menu == 'elements'} | tokenList}}"
        label="Guides &#x25BE;">
        <polymer-ui-menu-item href="/docs/polymer/layout-elements.html">Layout elements</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/docs/polymer/icons.html">Using core icons</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/docs/polymer/material.html">Material design with Polymer</polymer-ui-menu-item>
    </polymer-ui-submenu-item>

    <polymer-ui-submenu-item class="{{ {show: menu == 'docs'} | tokenList}}" id="gettingstartedmenu" label="Getting started" src="/images/picons/ic_polymer_source.svg">
      <polymer-ui-menu-item id="getcode" href="/docs/start/getting-the-code.html" class="{{ {show: menu == 'docs'} | tokenList}}">Get the Code</polymer-ui-menu-item>
      <polymer-ui-submenu-item label="Tutorial &#x25BE;">
        <polymer-ui-menu-item href="/docs/start/tutorial/intro.html">Getting started</polymer-ui-menu-item>
        <polymer-ui-menu-item href="/docs/start/tutorial/step-1.html">1: App structure</polymer-ui-menu-item>
        <polymer-ui-menu-item href="/docs/start/tutorial/step-2.html">2: Your own element</polymer-ui-menu-item>
        <polymer-ui-menu-item href="/docs/start/tutorial/step-3.html">3: Using data binding</polymer-ui-menu-item>
        <polymer-ui-menu-item href="/docs/start/tutorial/step-4.html">4: Finishing touches</polymer-ui-menu-item>
        <polymer-ui-menu-item href="/docs/start/tutorial/step-5.html">5: Your next app</polymer-ui-menu-item>
      </polymer-ui-submenu-item>
      <polymer-ui-menu-item href="/docs/start/usingelements.html">Using elements</polymer-ui-menu-item>
      <polymer-ui-submenu-item label="Creating elements &#x25BE;">
        <polymer-ui-menu-item href="/docs/start/creatingelements.html">The basics</polymer-ui-menu-item>
        <polymer-ui-menu-item href="/docs/start/reusableelements.html">Reusable elements</polymer-ui-menu-item>
      </polymer-ui-submenu-item>
      <polymer-ui-menu-item href="/docs/start/platform.html">The Platform</polymer-ui-menu-item>
      <polymer-ui-submenu-item label="Concepts" class="{{ {show: menu == 'docs'} | tokenList}}">
        <polymer-ui-menu-item href="/docs/start/everything.html">Understanding Polymer</polymer-ui-menu-item>
        <polymer-ui-menu-item href="/docs/start/customelements.html">Custom elements 101</polymer-ui-menu-item>
      </polymer-ui-submenu-item>
    </polymer-ui-submenu-item>

    <polymer-ui-submenu-item id="coremenu" label="Polymer" class="elements-creating {{ {show: menu == 'docs'} | tokenList}}" src="/images/picons/ic_polymer_source.svg">

      <polymer-ui-menu-item href="/docs/polymer/polymer.html">API developer guide</polymer-ui-menu-item>
      <polymer-ui-submenu-item label="Data binding &#x25BE;">
        <polymer-ui-menu-item href="/docs/polymer/databinding.html">Overview</polymer-ui-menu-item>
        <polymer-ui-menu-item href="/docs/polymer/binding-types.html">Types of bindings</polymer-ui-menu-item>
        <polymer-ui-menu-item href="/docs/polymer/expressions.html">Expressions</polymer-ui-menu-item>
        <polymer-ui-menu-item href="/docs/polymer/databinding-compat.html">Compatibility notes</polymer-ui-menu-item>
        <polymer-ui-menu-item href="/docs/polymer/databinding-advanced.html">Advanced topics</polymer-ui-menu-item>
        <polymer-ui-submenu-item label="Related libraries &#x25BE;">
          <polymer-ui-menu-item href="/docs/polymer/template.html">Template Binding</polymer-ui-menu-item>
          <polymer-ui-menu-item href="/docs/polymer/node_bind.html">Node.bind()</polymer-ui-menu-item>
        </polymer-ui-submenu-item>
      </polymer-ui-submenu-item>
      <polymer-ui-menu-item href="/docs/polymer/layout-attrs.html">Layout attributes</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/docs/polymer/styling.html">Styling elements</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/docs/polymer/touch.html">Touch &amp; gestures</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/docs/polymer/runtime-config.html">Runtime configuration</polymer-ui-menu-item>
    </polymer-ui-submenu-item>
    <polymer-ui-submenu-item id="platformmenu" label="Platform" class="platform {{ {show: menu == 'docs'} | tokenList}}" src="/images/picons/ic_polymer_source.svg">
      <polymer-ui-menu-item href="/platform/custom-elements.html">Custom Elements</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/platform/shadow-dom.html">Shadow DOM</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/platform/html-imports.html">HTML Imports</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/platform/web-animations.html">Web Animations</polymer-ui-menu-item>
    </polymer-ui-submenu-item>
    <polymer-ui-menu-item id="articles" href="/articles/" class="{{ {show: menu == 'docs' || menu == 'other' || menu == ''} | tokenList}}" src="/images/picons/ic_news_dark.png">Articles</polymer-ui-menu-item>
    <polymer-ui-menu-item href="/resources/video.html" class="{{ {show: menu == 'docs' || menu == 'other' || menu == ''} | tokenList}}" src="/images/picons/ic_video_dark_.png">Videos</polymer-ui-menu-item>
    <polymer-ui-submenu-item label="Resources" class="{{ {show: menu == 'other' || menu == ''} | tokenList}}" src="/images/picons/ic_polymer_source.svg">
      <polymer-ui-menu-item href="/resources/tooling-strategy.html">Tools &amp; testing</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/resources/compatibility.html">Browser compatibility</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/build/">Build status</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/resources/changelog.html">Releases</polymer-ui-menu-item>
      <polymer-ui-menu-item href="/resources/faq.html">FAQ</polymer-ui-menu-item>
    </polymer-ui-submenu-item>
  </polymer-ui-menu>
</template>
<script>
  Polymer('docs-menu', {
    ajaxify: false,
    isReady: false,
    coreElements: {},
    paperElements: {},
    ready: function() {
      this.coreElementsList = [];
      this.paperElementsList = [];
      for (var name in this.coreElements) {
        this.coreElementsList.push({name: name, url: this.coreElements[name]});
      }
      for (var name in this.paperElements) {
        this.paperElementsList.push({name: name, url: this.paperElements[name]});
      }
    },
    domReady: function() {
      this.isReady = true;
      this.menuChanged();
    },
    menuChanged: function() {
      // Automatically select menu item when .menu is set from ajax transition.
      if (this.isReady) {
        this.highlightItemWithCurrentURL();
      }
    },
    highlightItemWithCurrentURL: function(opt_href) {
      var href = opt_href || location.pathname + location.hash;

      if (href.match(/\/articles\//)) {
        this.$.mainmenu.selected = this.$.mainmenu.items.indexOf(this.$.articles);
        return;
      }

      // If href wasn't found, look for a corresponding data-href. This is hacky
      // but the first querySelector will fail because the elements' urls are
      // /docs/elements/core-elements.html#{{name}}.
      var item = this.shadowRoot.querySelector('[href$="' + href + '"]');
      if (!item) {
        item = this.shadowRoot.querySelector('[data-href$="' + href + '"]');
      }

      if (item) {
        var submenu = item.parentElement;

        submenu.selected = submenu.items.indexOf(item);

        // Selected item is not a submenu. Keep it selected and quit early.
        if (submenu == this.$.mainmenu) {
          return;
        }

        if (submenu.parentElement && submenu.parentElement.localName == 'polymer-ui-submenu-item') {
          do {
            submenu.parentElement.selected = submenu.parentElement.items.indexOf(submenu);
            submenu = submenu.parentElement;
          } while (submenu && submenu.localName == 'polymer-ui-submenu-item');
        } else {
          this.$.mainmenu.selected = this.$.mainmenu.items.indexOf(submenu);
        }
      }
    },
    onClick: function(e, detail, sender) {
      if (e.target.localName == 'polymer-ui-menu-item' && this.ajaxify) {
        this.fire('click', {link: e.target});
        e.preventDefault();
        e.stopPropagation();
      }
    }
  });
</script>
</polymer-element>
